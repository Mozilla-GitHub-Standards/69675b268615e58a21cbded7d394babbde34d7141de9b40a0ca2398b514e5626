#! /bin/bash
project_dir=$(dirname "${0}")/..
cd "${project_dir}"
source settings.shinclude

mkdir -p ./log/incremental/

JAVAMAXMEM=2048 "${KETTLE_LIBS}/../kitchen.sh" \
        -file "${ETL_HOME}/jobs/incremental_update.kjb" \
        -param:"ZOOKEEPER_HOST=${ZOOKEEPER_HOST}" \
    > "${ETL_HOME}/log/incremental/stdout_$(date +%Y%m%d_%H%M%S)" \
    2> "${ETL_HOME}/log/incremental/stderr_$(date +%Y%m%d_%H%M%S)"

# Give Lily some time for indexing before comitting the Solr indexes
sleep 15
./bin/index_commit
